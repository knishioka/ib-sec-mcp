# Gitleaks configuration for IB Analytics
# See https://github.com/gitleaks/gitleaks for more information

title = "IB Analytics Gitleaks Configuration"

# Extend the default gitleaks config
[extend]
useDefault = true

# Custom rules for Interactive Brokers credentials
[[rules]]
id = "ib-query-id"
description = "Interactive Brokers Flex Query ID"
regex = '''(?i)(query_?id|QUERY_?ID)\s*[=:]\s*['"]?(\d{7,10})['"]?'''
secretGroup = 2
keywords = [
    "QUERY_ID",
    "query_id",
    "QueryID",
]

[[rules]]
id = "ib-token"
description = "Interactive Brokers Flex Query Token"
regex = '''(?i)(token|TOKEN)\s*[=:]\s*['"]?(\d{18,25})['"]?'''
secretGroup = 2
keywords = [
    "TOKEN",
    "token",
    "flex_token",
    "FLEX_TOKEN",
]

[[rules]]
id = "ib-account-id"
description = "Interactive Brokers Account ID"
regex = '''U\d{7,10}'''
# Note: No keywords required - should always detect U followed by 7-10 digits

# Additional security patterns
[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)api[_-]?key\s*[=:]\s*['"]?([a-zA-Z0-9]{20,})['"]?'''
secretGroup = 1
keywords = [
    "api_key",
    "apikey",
    "API_KEY",
]

[[rules]]
id = "notion-database-id"
description = "Notion Database or Data Source ID in environment variable"
regex = '''(?i)(notion.*(?:db|database|data[_-]?source)[_-]?id|data[_-]?source[_-]?id)\s*[=:]\s*['"]?([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})['"]?'''
secretGroup = 2
keywords = [
    "NOTION_INVESTMENT_DECISIONS_DB_ID",
    "NOTION_INVESTMENT_DECISIONS_DATA_SOURCE_ID",
    "notion_db_id",
    "notion_database_id",
    "data_source_id",
    "collection://",
]

[[rules]]
id = "notion-page-id"
description = "Notion Page ID in URL"
regex = '''notion\.so/[a-zA-Z0-9-]+/([0-9a-f]{32}|[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})'''
secretGroup = 1

# Allowlist for false positives
[allowlist]
description = "Allowlisted files and patterns"
paths = [
    # Test files and examples
    '''tests/fixtures/.*''',
    '''\.env\.example$''',
    '''\.env\.template$''',

    # Configuration examples
    '''.pre-commit-config\.yaml$''',
    '''.gitleaks\.toml$''',

    # IMPORTANT: Documentation files are NOT allowlisted
    # Real account IDs should be detected in docs
]

regexes = [
    # Example values in documentation
    '''QUERY_ID=your_query_id_here''',
    '''TOKEN=your_token_here''',
    '''QUERY_ID=123''',
    '''TOKEN=abc''',
    '''query_id="123"''',
    '''token="abc"''',
    '''1234567890123456789012345''', # Generic placeholder numbers

    # Generic account IDs (for documentation examples)
    # Use U followed by 7 digits for examples (e.g., U1234567)
    '''U1234567''',
    '''U7654321''',
    '''U1111111''',
    '''U1234567''',  # Documentation example account ID
    '''U1234567''',  # Documentation example account ID

    # Code placeholders
    '''\.\.\.$''', # Ellipsis placeholders
    '''your_.*_here''',
    '''<.*>''', # XML/HTML tags
    '''example''',
    '''sample''',
    '''test''',
    '''dummy''',

    # Notion placeholders
    '''your_database_id_here''',
    '''your_data_source_id_here''',
    '''xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx''', # UUID placeholder pattern
    '''<FROM_ENV_VAR>''',

    # IMPORTANT: Real account IDs (U followed by 8-10 digits) will be detected
    # Note: DO NOT add real credentials here
]

# Stopwords to reduce false positives
stopwords = [
    "example",
    "sample",
    "test",
    "dummy",
    "placeholder",
    "your",
    "here",
    "xxx",
    "yyy",
]

# Commits to ignore (if needed)
# commits = [
#   "commit-sha-to-ignore",
# ]
